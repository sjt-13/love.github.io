<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>to wyx</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: fixed;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* 雪花容器 - 最高层级 */
        #snow-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        .snowflake {
            position: absolute;
            color: rgba(255, 255, 255, 0.95);
            font-size: 20px;
            user-select: none;
            pointer-events: none;
            text-shadow:
                0 0 15px rgba(173, 216, 230, 0.8),
                0 0 30px rgba(135, 206, 250, 0.6),
                0 0 45px rgba(176, 224, 230, 0.4);
            opacity: 0.9;
            z-index: 10;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.7));
            mix-blend-mode: screen;
        }

        #album-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 70%;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-image {
            width: 100%;
            height: 100%;
            border-radius: 25px;
            overflow: hidden;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            perspective: 1000px;

            /* 精美边框效果 */
            border: 3px solid transparent;
            background:
                linear-gradient(45deg, #000 0%, #000 100%),
                linear-gradient(135deg, #ff6b9d, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #dda0dd, #98d8c8);
            background-clip: padding-box, border-box;
            background-origin: padding-box, border-box;

            /* 多重阴影效果 */
            box-shadow:
                0 0 50px rgba(255, 107, 157, 0.3),
                0 0 80px rgba(78, 205, 196, 0.2),
                0 0 120px rgba(69, 183, 209, 0.1),
                inset 0 0 30px rgba(255, 255, 255, 0.1);

            /* 3D立体效果 */
            transform-style: preserve-3d;
        }

        /* 装饰性角标 */
        .main-image::before,
        .main-image::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            z-index: 3;
        }

        .main-image::before {
            top: 15px;
            left: 15px;
            border-top: 2px solid #ff6b9d;
            border-left: 2px solid #ff6b9d;
            border-radius: 8px 0 0 0;
        }

        .main-image::after {
            bottom: 15px;
            right: 15px;
            border-bottom: 2px solid #4ecdc4;
            border-right: 2px solid #4ecdc4;
            border-radius: 0 0 8px 0;
        }

        /* 添加额外的装饰角 */
        .corner-top-right,
        .corner-bottom-left {
            position: absolute;
            width: 30px;
            height: 30px;
            z-index: 3;
        }

        .corner-top-right {
            top: 15px;
            right: 15px;
            border-top: 2px solid #45b7d1;
            border-right: 2px solid #45b7d1;
            border-radius: 0 8px 0 0;
        }

        .corner-bottom-left {
            bottom: 15px;
            left: 15px;
            border-bottom: 2px solid #96ceb4;
            border-left: 2px solid #96ceb4;
            border-radius: 0 0 0 8px;
        }

        .main-image img {
            width: calc(100% - 10px);
            height: calc(100% - 10px);
            object-fit: cover;
            position: absolute;
            top: 5px;
            left: 5px;
            opacity: 0;
            transition: opacity 1s ease;
            transform-style: preserve-3d;
            border-radius: 20px;
        }

        .main-image img.active {
            opacity: 1;
        }

        /* 点击提示 */
        .click-prompt {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 30px;
            font-weight: bold;
            z-index: 6;
            text-align: center;
            cursor: pointer;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            animation: pulse 2s ease-in-out infinite;
            background: linear-gradient(135deg, #ff6b9d, #4ecdc4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 20px;
            border-radius: 15px;
        }

        /* 倒计时样式 */
        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 80px;
            font-weight: bold;
            z-index: 7;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            background: linear-gradient(135deg, #ff6b9d, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: countdownPulse 1s ease-in-out;
            display: none;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 0.8;
            }
        }

        @keyframes countdownPulse {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        /* 雪花动画关键帧 */
        @keyframes snowFall {
            0% {
                transform: translateY(-50px) translateX(0) rotate(0deg);
                opacity: 0;
            }

            10% {
                opacity: 1;
            }

            90% {
                opacity: 0.8;
            }

            100% {
                transform: translateY(100vh) translateX(var(--sway-distance)) rotate(360deg);
                opacity: 0;
            }
        }

        /* 音乐控制按钮 */
        .music-control {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 8;
            background: linear-gradient(135deg, #ff6b9d, #4ecdc4);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            touch-action: manipulation;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .music-control:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 107, 157, 0.7);
        }

        .music-control svg {
            width: 28px;
            height: 28px;
            fill: white;
        }

        /* 加载提示 */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            z-index: 9;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* 爱心动画页面 */
        #heart-page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 20;
            display: none;
        }

        #pinkboard {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        #heart-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: min(8vw, 32px);
            color: #ea80b0;
            text-shadow: 0 0 15px rgba(234, 128, 176, 0.9);
            z-index: 21;
            pointer-events: none;
            font-weight: bold;
            animation: heartbeat 1.5s infinite;
        }

        @keyframes heartbeat {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
            }

            25% {
                transform: translate(-50%, -50%) scale(1.1);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.05);
            }

            75% {
                transform: translate(-50%, -50%) scale(1.15);
            }
        }

        .floating-text {
            position: absolute;
            color: #ea80b0;
            font-size: min(6vw, 24px);
            pointer-events: none;
            z-index: 20;
            text-shadow: 0 0 10px rgba(234, 128, 176, 0.8);
            animation: float 8s infinite ease-in-out;
            font-weight: bold;
        }

        @keyframes float {

            0%,
            100% {
                transform: translate(0, 0) rotate(0deg);
                opacity: 0.7;
            }

            25% {
                transform: translate(30px, -20px) rotate(8deg);
                opacity: 1;
            }

            50% {
                transform: translate(-20px, 15px) rotate(-5deg);
                opacity: 0.8;
            }

            75% {
                transform: translate(15px, 25px) rotate(3deg);
                opacity: 0.9;
            }
        }

        /* 状态栏安全区域 */
        .safe-area {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }

        /* 响应式调整 */
        @media (max-width: 430px) and (max-height: 932px) {
            #album-container {
                width: 95%;
                height: 65%;
            }

            .main-image {
                border-radius: 20px;
            }

            .main-image img {
                border-radius: 15px;
            }

            .click-prompt {
                font-size: 20px;
            }

            .countdown {
                font-size: 60px;
            }

            .music-control {
                bottom: 25px;
                right: 25px;
                width: 55px;
                height: 55px;
            }

            .music-control svg {
                width: 26px;
                height: 26px;
            }
        }

        /* 横屏模式 */
        @media (orientation: landscape) and (max-height: 430px) {
            #album-container {
                width: 70%;
                height: 85%;
            }

            .main-image {
                border-radius: 15px;
            }

            .main-image img {
                border-radius: 10px;
            }

            .click-prompt {
                font-size: 18px;
            }

            .countdown {
                font-size: 50px;
            }
        }

        /* 防止文本选择 */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>

<body>
    <div id="container" class="safe-area">
        <div id="canvas-container"></div>
        <div id="snow-container"></div>
        <div id="album-container">
            <div class="main-image">
                <!-- 点击提示 -->
                <div class="click-prompt" id="click-prompt">点我一下</div>
                <!-- 倒计时显示 -->
                <div class="countdown" id="countdown"></div>
                <!-- 主图片将通过JavaScript动态生成 -->
                <div class="corner-top-right"></div>
                <div class="corner-bottom-left"></div>
            </div>
        </div>
        <div class="music-control" id="music-control">
            <svg viewBox="0 0 24 24">
                <path d="M6 6h12v12H6z" />
            </svg>
        </div>
        <div class="loading" id="loading">正在加载音乐，请稍候...</div>

        <!-- 爱心动画页面 -->
        <div id="heart-page">
            <canvas id="pinkboard"></canvas>
            <div id="heart-text">❤王雨欣❤</div>
        </div>
    </div>

    <!-- 引入Three.js库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // 图片数据 - 针对手机优化
        const images = [
            {
                src: "image/1.jpg"
            },
            {
                src: "image/2.jpg"
            },
            {
                src: "image/3.jpg"
            },
            {
                src: "image/4.jpg"
            },
            {
                src: "image/5.jpg"
            },
            {
                src: "image/6.jpg"
            },
            {
                src: "image/7.jpg"
            },
            {
                src: "image/8.jpg"
            },
            {
                src: "image/9.jpg"
            },
            {
                src: "image/10.jpg"
            },
            {
                src: "image/11.jpg"
            },
            {
                src: "image/12.jpg"
            },
            {
                src: "image/13.jpg"
            },
            {
                src: "image/14.jpg"
            },
            {
                src: "image/15.jpg"
            },
            {
                src: "image/16.jpg"
            },
            {
                src: "image/17.jpg"
            }
        ];

        // 当前显示的图片索引
        let currentIndex = 0;
        let backgroundMusic;
        let isMusicPlaying = false;
        let isSlideshowStarted = false;
        let slideshowInterval;
        let loopCount = 0;
        const maxLoops = 1; // 轮播循环次数

        // 初始化雪花效果
        function initSnow() {
            const snowContainer = document.getElementById('snow-container');
            const snowflakes = ['❄', '❅', '❆', '•', '·'];
            const snowCount = 60;

            for (let i = 0; i < snowCount; i++) {
                createSnowflake(snowContainer, snowflakes);
            }
        }

        // 创建单个雪花
        function createSnowflake(container, snowflakes) {
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';

            const randomFlake = snowflakes[Math.floor(Math.random() * snowflakes.length)];
            snowflake.textContent = randomFlake;

            const size = Math.random() * 20 + 15;
            snowflake.style.fontSize = `${size}px`;

            const opacity = Math.random() * 0.7 + 0.3;
            snowflake.style.opacity = opacity;

            const startX = Math.random() * 100;
            snowflake.style.left = `${startX}vw`;
            snowflake.style.top = '-50px';

            const fallDuration = Math.random() * 12 + 10;
            const swayDistance = Math.random() * 100 + 50;

            snowflake.style.setProperty('--sway-distance', `${Math.random() > 0.5 ? '' : '-'}${swayDistance}px`);

            snowflake.style.animation = `snowFall ${fallDuration}s linear infinite`;

            snowflake.style.animationDelay = `${Math.random() * 5}s`;

            container.appendChild(snowflake);

            setTimeout(() => {
                if (snowflake.parentNode) {
                    snowflake.remove();
                    createSnowflake(container, snowflakes);
                }
            }, fallDuration * 1000);
        }

        // 初始化相册
        function initAlbum() {
            const mainImageContainer = document.querySelector('.main-image');

            const existingImages = mainImageContainer.querySelectorAll('img');
            existingImages.forEach(img => img.remove());

            images.forEach((image, index) => {
                const img = document.createElement('img');
                img.src = image.src;
                img.alt = `照片 ${index + 1}`;
                img.dataset.index = index;
                img.loading = "eager";
                img.style.display = 'none';

                img.onerror = function () {
                    console.error(`图片加载失败: ${image.src}`);
                };

                mainImageContainer.appendChild(img);
            });
        }

        // 开始倒计时
        function startCountdown() {
            const countdownElement = document.getElementById('countdown');
            const clickPrompt = document.getElementById('click-prompt');

            clickPrompt.style.display = 'none';

            let count = 3;

            function showCount() {
                if (count > 0) {
                    countdownElement.textContent = count;
                    countdownElement.style.display = 'block';

                    countdownElement.style.animation = 'none';
                    setTimeout(() => {
                        countdownElement.style.animation = 'countdownPulse 1s ease-in-out';
                    }, 10);

                    count--;
                    setTimeout(showCount, 1000);
                } else {
                    countdownElement.style.display = 'none';
                    startSlideshow();
                }
            }

            showCount();
        }

        // 开始轮播
        function startSlideshow() {
            if (isSlideshowStarted) return;

            isSlideshowStarted = true;

            document.querySelectorAll('.main-image img').forEach(img => {
                img.style.display = 'block';
            });

            document.querySelectorAll('.main-image img')[0].classList.add('active');

            slideshowInterval = setInterval(() => {
                currentIndex = (currentIndex + 1) % images.length;

                // 检查是否完成一轮循环
                if (currentIndex === 0) {
                    loopCount++;
                    if (loopCount >= maxLoops) {
                        // 轮播结束，切换到爱心页面
                        clearInterval(slideshowInterval);
                        showHeartAnimation();
                        return;
                    }
                }

                document.querySelectorAll('.main-image img').forEach((img, i) => {
                    if (i === currentIndex) {
                        img.classList.add('active');
                    } else {
                        img.classList.remove('active');
                    }
                });
            }, 1000);
        }

        // 显示爱心动画
        function showHeartAnimation() {
            // 隐藏相册页面
            document.getElementById('album-container').style.display = 'none';
            document.getElementById('music-control').style.display = 'none';
            document.getElementById('canvas-container').style.display = 'none';
            document.getElementById('snow-container').style.display = 'none';

            // 显示爱心页面
            const heartPage = document.getElementById('heart-page');
            heartPage.style.display = 'block';

            // 初始化爱心动画
            initHeartAnimation();
        }

        // 初始化爱心动画
        function initHeartAnimation() {
            // 爱心粒子效果
            var settings = {
                particles: {
                    length: 400,
                    duration: 2,
                    velocity: 80,
                    effect: -0.75,
                    size: 25,
                },
            };

            // RequestAnimationFrame polyfill
            (function () {
                var b = 0;
                var c = ["ms", "moz", "webkit", "o"];
                for (var a = 0; a < c.length && !window.requestAnimationFrame; ++a) {
                    window.requestAnimationFrame = window[c[a] + "RequestAnimationFrame"];
                    window.cancelAnimationFrame = window[c[a] + "CancelAnimationFrame"] || window[c[a] + "CancelRequestAnimationFrame"];
                }
                if (!window.requestAnimationFrame) {
                    window.requestAnimationFrame = function (h, e) {
                        var d = new Date().getTime();
                        var f = Math.max(0, 16 - (d - b));
                        var g = window.setTimeout(function () { h(d + f) }, f);
                        b = d + f;
                        return g;
                    };
                }
                if (!window.cancelAnimationFrame) {
                    window.cancelAnimationFrame = function (d) {
                        clearTimeout(d);
                    };
                }
            }());

            // Point class
            var Point = (function () {
                function Point(x, y) {
                    this.x = (typeof x !== 'undefined') ? x : 0;
                    this.y = (typeof y !== 'undefined') ? y : 0;
                }
                Point.prototype.clone = function () {
                    return new Point(this.x, this.y);
                };
                Point.prototype.length = function (length) {
                    if (typeof length == 'undefined')
                        return Math.sqrt(this.x * this.x + this.y * this.y);
                    this.normalize();
                    this.x *= length;
                    this.y *= length;
                    return this;
                };
                Point.prototype.normalize = function () {
                    var length = this.length();
                    this.x /= length;
                    this.y /= length;
                    return this;
                };
                return Point;
            })();

            // Particle class
            var Particle = (function () {
                function Particle() {
                    this.position = new Point();
                    this.velocity = new Point();
                    this.acceleration = new Point();
                    this.age = 0;
                }
                Particle.prototype.initialize = function (x, y, dx, dy) {
                    this.position.x = x;
                    this.position.y = y;
                    this.velocity.x = dx;
                    this.velocity.y = dy;
                    this.acceleration.x = dx * settings.particles.effect;
                    this.acceleration.y = dy * settings.particles.effect;
                    this.age = 0;
                };
                Particle.prototype.update = function (deltaTime) {
                    this.position.x += this.velocity.x * deltaTime;
                    this.position.y += this.velocity.y * deltaTime;
                    this.velocity.x += this.acceleration.x * deltaTime;
                    this.velocity.y += this.acceleration.y * deltaTime;
                    this.age += deltaTime;
                };
                Particle.prototype.draw = function (context, image) {
                    function ease(t) {
                        return (--t) * t * t + 1;
                    }
                    var size = image.width * ease(this.age / settings.particles.duration);
                    context.globalAlpha = 1 - this.age / settings.particles.duration;
                    context.drawImage(image, this.position.x - size / 2, this.position.y - size / 2, size, size);
                };
                return Particle;
            })();

            // ParticlePool class
            var ParticlePool = (function () {
                var particles,
                    firstActive = 0,
                    firstFree = 0,
                    duration = settings.particles.duration;

                function ParticlePool(length) {
                    particles = new Array(length);
                    for (var i = 0; i < particles.length; i++)
                        particles[i] = new Particle();
                }
                ParticlePool.prototype.add = function (x, y, dx, dy) {
                    particles[firstFree].initialize(x, y, dx, dy);

                    firstFree++;
                    if (firstFree == particles.length) firstFree = 0;
                    if (firstActive == firstFree) firstActive++;
                    if (firstActive == particles.length) firstActive = 0;
                };
                ParticlePool.prototype.update = function (deltaTime) {
                    var i;

                    if (firstActive < firstFree) {
                        for (i = firstActive; i < firstFree; i++)
                            particles[i].update(deltaTime);
                    }
                    if (firstFree < firstActive) {
                        for (i = firstActive; i < particles.length; i++)
                            particles[i].update(deltaTime);
                        for (i = 0; i < firstFree; i++)
                            particles[i].update(deltaTime);
                    }

                    while (particles[firstActive].age >= duration && firstActive != firstFree) {
                        firstActive++;
                        if (firstActive == particles.length) firstActive = 0;
                    }
                };
                ParticlePool.prototype.draw = function (context, image) {
                    var i;

                    if (firstActive < firstFree) {
                        for (i = firstActive; i < firstFree; i++)
                            particles[i].draw(context, image);
                    }
                    if (firstFree < firstActive) {
                        for (i = firstActive; i < particles.length; i++)
                            particles[i].draw(context, image);
                        for (i = 0; i < firstFree; i++)
                            particles[i].draw(context, image);
                    }
                };
                return ParticlePool;
            })();

            // 爱心动画
            (function (canvas) {
                var context = canvas.getContext('2d'),
                    particles = new ParticlePool(settings.particles.length),
                    particleRate = settings.particles.length / settings.particles.duration,
                    time;

                function pointOnHeart(t) {
                    return new Point(
                        160 * Math.pow(Math.sin(t), 3),
                        130 * Math.cos(t) - 50 * Math.cos(2 * t) - 20 * Math.cos(3 * t) - 10 * Math.cos(4 * t) + 25
                    );
                }

                var image = (function () {
                    var canvas = document.createElement('canvas'),
                        context = canvas.getContext('2d');
                    canvas.width = settings.particles.size;
                    canvas.height = settings.particles.size;

                    function to(t) {
                        var point = pointOnHeart(t);
                        point.x = settings.particles.size / 2 + point.x * settings.particles.size / 350;
                        point.y = settings.particles.size / 2 - point.y * settings.particles.size / 350;
                        return point;
                    }

                    context.beginPath();
                    var t = -Math.PI;
                    var point = to(t);
                    context.moveTo(point.x, point.y);
                    while (t < Math.PI) {
                        t += 0.01;
                        point = to(t);
                        context.lineTo(point.x, point.y);
                    }
                    context.closePath();
                    context.fillStyle = '#ea80b0';
                    context.fill();
                    var image = new Image();
                    image.src = canvas.toDataURL();
                    return image;
                })();

                function render() {
                    requestAnimationFrame(render);

                    var newTime = new Date().getTime() / 1000,
                        deltaTime = newTime - (time || newTime);
                    time = newTime;

                    context.clearRect(0, 0, canvas.width, canvas.height);

                    var amount = particleRate * deltaTime;
                    for (var i = 0; i < amount; i++) {
                        var pos = pointOnHeart(Math.PI - 2 * Math.PI * Math.random());
                        var dir = pos.clone().length(settings.particles.velocity);
                        particles.add(canvas.width / 2 + pos.x, canvas.height / 2 - pos.y, dir.x, -dir.y);
                    }

                    particles.update(deltaTime);
                    particles.draw(context, image);
                }

                function onResize() {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }
                window.onresize = onResize;

                onResize();
                setTimeout(render, 10);
            })(document.getElementById('pinkboard'));

            // 创建浮动文字
            function createFloatingText() {
                const text = document.createElement('div');
                text.className = 'floating-text';
                text.textContent = '❤王雨欣❤';

                const x = Math.random() * (window.innerWidth - 100);
                const y = Math.random() * (window.innerHeight - 50);
                text.style.left = `${x}px`;
                text.style.top = `${y}px`;

                text.style.animationDelay = `${Math.random() * 5}s`;

                document.getElementById('heart-page').appendChild(text);

                setTimeout(() => {
                    if (text.parentNode) {
                        text.parentNode.removeChild(text);
                    }
                    createFloatingText();
                }, 8000 + Math.random() * 5000);
            }

            // 初始化浮动文字
            const floatingTextCount = 8;
            for (let i = 0; i < floatingTextCount; i++) {
                setTimeout(createFloatingText, i * 1500);
            }
        }

        // 初始化背景音乐
        function initBackgroundMusic() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';

            backgroundMusic = new Audio();
            backgroundMusic.src = "13.mp3";
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.5;

            backgroundMusic.addEventListener('error', function (e) {
                console.error('音乐加载失败:', e);
                loading.innerHTML = '音乐文件加载失败<br>请检查文件路径';
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 3000);
            });

            backgroundMusic.addEventListener('canplaythrough', function () {
                console.log('音乐可以播放');
                loading.style.display = 'none';
            });

            document.getElementById('click-prompt').addEventListener('click', function () {
                const playPromise = backgroundMusic.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        isMusicPlaying = true;
                        updateMusicButton();
                        startCountdown();
                    }).catch(error => {
                        console.log("音乐播放失败:", error);
                        startCountdown();
                    });
                }
            });
        }

        // 更新音乐按钮状态
        function updateMusicButton() {
            const musicControl = document.getElementById('music-control');
            if (isMusicPlaying) {
                musicControl.innerHTML = '<svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg>';
            } else {
                musicControl.innerHTML = '<svg viewBox="0 0 24 24"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>';
            }
        }

        // 音乐控制按钮事件
        document.getElementById('music-control').addEventListener('click', function (e) {
            e.stopPropagation();
            if (isMusicPlaying) {
                backgroundMusic.pause();
                isMusicPlaying = false;
            } else {
                backgroundMusic.play().then(() => {
                    isMusicPlaying = true;
                }).catch(err => {
                    console.log('播放失败:', err);
                });
            }
            updateMusicButton();
        });

        // 初始化星空背景
        function initStarfield() {
            const canvasContainer = document.getElementById('canvas-container');

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({
                alpha: true,
                antialias: true
            });

            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 1);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            canvasContainer.appendChild(renderer.domElement);

            const starCount = 800;

            const starGeometry = new THREE.BufferGeometry();
            const starPositions = new Float32Array(starCount * 3);

            for (let i = 0; i < starCount * 3; i += 3) {
                starPositions[i] = (Math.random() - 0.5) * 2000;
                starPositions[i + 1] = (Math.random() - 0.5) * 2000;
                starPositions[i + 2] = (Math.random() - 0.5) * 2000;
            }

            starGeometry.setAttribute('position', new THREE.BufferAttribute(starPositions, 3));

            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 1.2,
                transparent: true
            });

            const starField = new THREE.Points(starGeometry, starMaterial);
            scene.add(starField);

            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                starField.rotation.y += 0.0002;
                renderer.render(scene, camera);
            }

            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            });
        }

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', () => {
            initSnow();
            initStarfield();
            initAlbum();
            initBackgroundMusic();
        });

        // 防止滚动
        document.addEventListener('touchmove', function (e) {
            e.preventDefault();
        }, { passive: false });
    </script>
</body>

</html>